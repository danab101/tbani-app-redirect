<!DOCTYPE html>
<html>
<head>
  <title>Redirecting to Tbani App</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script>
    function redirectToApp() {
      const path = window.location.pathname;
      const postMatch = path.match(/\/posts\/([^\/]+)/);
      const postId = postMatch ? postMatch[1] : null;
      const appLink = postId ? `tbani://posts/${postId}` : 'tbani://';
      const storeIOS = 'https://apps.apple.com/sa/app/tbani-%D8%AA%D8%A8%D9%86%D9%8A/id6751329027';
      const storeAndroid = 'https://play.google.com/store/apps/details?id=com.yourcompany.tbani';

      const isIOS = /iPhone|iPad|iPod/.test(navigator.userAgent);
      const isAndroid = /Android/.test(navigator.userAgent);

      const start = Date.now();
      let hidden = false;

      // Detect when app opens (tab loses focus)
      window.addEventListener('blur', () => hidden = true);
      document.addEventListener('visibilitychange', () => {
        if (document.hidden) hidden = true;
      });

      // Try to open the app
      window.location.href = appLink;

      // Fallback only if no app opened after 2 seconds
      setTimeout(() => {
        const elapsed = Date.now() - start;
        if (!hidden && elapsed < 2000) {
          if (isIOS) window.location.href = storeIOS;
          else if (isAndroid) window.location.href = storeAndroid;
          else window.location.href = storeIOS;
        }
      }, 1800);
    }

    window.onload = redirectToApp;
  </script>
</head>
<body>
  <div style="text-align: center; padding: 50px; font-family: Arial, sans-serif;">
    <h2>Opening Tbani App...</h2>
    <p>Please wait while we redirect you.</p>
  </div>
</body>
</html>

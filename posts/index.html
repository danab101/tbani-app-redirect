<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Opening Tbani...</title>
  <script>
    function openApp() {
      // Extract post ID from the URL path
      // Expected URL: /tbani-app-redirect/posts/POST_ID
      const pathParts = window.location.pathname.split('/').filter(part => part);
      console.log('Path parts:', pathParts);
      
      let postId = null;
      if (pathParts.length >= 3 && pathParts[0] === 'tbani-app-redirect' && pathParts[1] === 'posts') {
        postId = pathParts[2];
      }
      
      console.log('Extracted postId:', postId);

      if (!postId) {
        console.log('No post ID found');
        redirectToStore();
        return;
      }

      // Try to open app
      const appLink = `tbani://posts/${postId}`;
      console.log('Opening app with:', appLink);
      const now = Date.now();
      window.location = appLink;

      // Redirect to store if app not opened
      setTimeout(function () {
        if (Date.now() - now < 2000) {
          console.log('App not opened, redirecting to store');
          redirectToStore();
        }
      }, 1500);
    }

    function redirectToStore() {
      const userAgent = navigator.userAgent || navigator.vendor || window.opera;
      if (/android/i.test(userAgent)) {
        window.location.href = "https://play.google.com/store/apps/details?id=com.yourcompany.tbani";
      } else if (/iPad|iPhone|iPod/.test(userAgent)) {
        window.location.href = "https://apps.apple.com/sa/app/tbani-%D8%AA%D8%A8%D9%86%D9%8A/id6751329027";
      } else {
        window.location.href = "https://apps.apple.com/sa/app/tbani-%D8%AA%D8%A8%D9%86%D9%8A/id6751329027";
      }
    }

    window.onload = openApp;
  </script>
</head>
<body>
  <p>Opening your Tbani post...</p>
</body>
</html>

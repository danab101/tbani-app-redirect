<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Opening Tbani...</title>
  <script>
    function openApp() {
      // Extract post ID from the URL path
      // Expected URL: /tbani/posts/POST_ID or /posts/POST_ID
      const pathParts = window.location.pathname.split('/').filter(Boolean);
      console.log('Path parts:', pathParts);

      let postId = null;
      // Support both /tbani/posts/:id and /posts/:id
      const postsIndex = pathParts.indexOf('posts');
      if (postsIndex !== -1 && pathParts.length > postsIndex + 1) {
        postId = pathParts[postsIndex + 1];
      }

      console.log('Extracted postId:', postId);

      // Construct links
      const appLink = postId ? `tbani://posts/${postId}` : 'tbani://';
      const storeIOS = 'https://apps.apple.com/sa/app/tbani-%D8%AA%D8%A8%D9%86%D9%8A/id6751329027';
      const storeAndroid = 'https://play.google.com/store/apps/details?id=com.yourcompany.tbani';

      const isIOS = /iPhone|iPad|iPod/.test(navigator.userAgent);
      const isAndroid = /Android/.test(navigator.userAgent);

      const start = Date.now();
      let hidden = false;

      // Detect when the app opens (browser loses focus or becomes hidden)
      window.addEventListener('blur', () => hidden = true);
      document.addEventListener('visibilitychange', () => {
        if (document.hidden) hidden = true;
      });

      console.log('Opening app link:', appLink);
      window.location.href = appLink;

      // Wait and redirect to store only if app didn't open
      setTimeout(() => {
        const elapsed = Date.now() - start;
        if (!hidden && elapsed < 2000) {
          console.log('App did not open, redirecting to store');
          if (isIOS) window.location.href = storeIOS;
          else if (isAndroid) window.location.href = storeAndroid;
          else window.location.href = storeIOS;
        } else {
          console.log('App opened successfully or user left page');
        }
      }, 1800);
    }

    window.onload = openApp;
  </script>
</head>
<body>
  <div style="text-align: center; padding: 40px; font-family: Arial, sans-serif;">
    <h2>Opening Tbani App...</h2>
    <p>If the app doesnâ€™t open automatically, please check your App Store or Play Store.</p>
  </div>
</body>
</html>
